# Main Feed Architecture

## 1. Main Feed Structure

```
main_feed/
├── feed/                    # Main feed container
│   ├── feed_model.dart      # Feed state management
│   └── feed_widget.dart     # Feed UI components
├── feed_item/              # Individual feed items
│   ├── content/            # Content display components
│   │   ├── video/
│   │   ├── actions/
│   │   ├── comments/
│   │   └── article/
│   ├── question/           # Question components
│   │   ├── input_text/
│   │   ├── input_select/
│   │   ├── input_slider/
│   │   └── input_choice/
│   ├── plugins/            # Plugin components
│   │   └── weather/
│   └── ende/              # End components
│       ├── challenge/
│       └── quote/
└── feed_item_tile/        # Feed item display components
```

## 2. Feed Flow Diagram

```mermaid
graph TD
    A[Main Feed] --> B[Feed Items]
    B --> C[Content Items]
    B --> D[Question Items]
    B --> E[Plugin Items]
    B --> F[End Items]
    C --> G[Video Content]
    C --> H[Article Content]
    C --> I[Comments]
    D --> J[Text Input]
    D --> K[Select Input]
    D --> L[Slider Input]
    D --> M[Choice Input]
    E --> N[Weather Plugin]
    F --> O[Challenge End]
    F --> P[Quote End]
```

## 3. Firebase Schema

### 3.1 Feed Collection
```json
{
  "feeds": {
    "feedId": {
      "type": "string",
      "title": "string",
      "description": "string",
      "createdAt": "timestamp",
      "updatedAt": "timestamp",
      "author": "userId",
      "content": {
        "type": "string",
        "data": "object"
      },
      "interactions": {
        "likes": ["userId"],
        "comments": [{
          "userId": "string",
          "text": "string",
          "timestamp": "timestamp"
        }]
      },
      "metadata": {
        "views": "number",
        "shares": "number"
      }
    }
  }
}
```

### 3.2 Feed Items Collection
```json
{
  "feed_items": {
    "itemId": {
      "feedId": "string",
      "type": "string",
      "order": "number",
      "content": {
        "type": "string",
        "data": "object"
      },
      "interactions": {
        "responses": [{
          "userId": "string",
          "response": "object",
          "timestamp": "timestamp"
        }]
      }
    }
  }
}
```

## 4. Component Architecture

### 4.1 Feed Container
```mermaid
classDiagram
    class FeedWidget {
        +PageController pageViewController
        +ChallengeCardModel challengeCardModel
        +HealthHubModel healthHubModel
        +OnboardingModel onboardingModel
        +initState()
        +dispose()
        +smartCamActionBlock()
    }
    
    class FeedItemWidget {
        +FeedItemQuestionModel feedItemQuestionModel
        +FeedItemValueModel feedItemValueModel
        +FeedItemContentModel feedItemContentModel
        +initState()
        +dispose()
    }
```

### 4.2 Feed Item Types
```mermaid
graph LR
    A[Feed Item] --> B[Content]
    A --> C[Question]
    A --> D[Plugin]
    A --> E[End]
    
    B --> B1[Video]
    B --> B2[Article]
    B --> B3[Comments]
    
    C --> C1[Text Input]
    C --> C2[Select Input]
    C --> C3[Slider Input]
    C --> C4[Choice Input]
    
    D --> D1[Weather]
    
    E --> E1[Challenge]
    E --> E2[Quote]
```

## 5. State Management

### 5.1 Feed State
```dart
class FeedModel {
  int page;
  UsersRecord? userDoc;
  InstantTimer? UpdateUserSessionTimer;
  UserSessionsRecord? newUserSession;
  PageController? pageViewController;
  
  // Component Models
  ChallengeCardModel challengeCardModel;
  HealthHubModel healthHubModel;
  OnboardingModel onboardingModel;
}
```

### 5.2 Feed Item State
```dart
class FeedItemModel {
  ValuesRecord? newValue;
  QuestionAnswersRecord? newQuestionAnswer;
  
  // Component Models
  FeedItemQuestionModel feedItemQuestionModel;
  FeedItemValueModel feedItemValueModel;
  FeedItemContentModel feedItemContentModel;
  FeedItemProfileModel feedItemProfileModel;
  FeedItemWeatherModel feedItemWeatherModel;
}
```

## 6. Data Flow

### 6.1 Feed Loading Flow
```mermaid
sequenceDiagram
    participant User
    participant App
    participant Firebase
    participant Cache

    User->>App: Open Feed
    App->>Firebase: Fetch Feed Data
    Firebase-->>App: Feed Documents
    App->>Cache: Store Feed Data
    App->>App: Build Feed UI
    App-->>User: Display Feed
```

### 6.2 Feed Item Interaction Flow
```mermaid
sequenceDiagram
    participant User
    participant App
    participant Firebase
    participant Analytics

    User->>App: Interact with Feed Item
    App->>Firebase: Update Interaction
    Firebase-->>App: Update Confirmed
    App->>Analytics: Log Interaction
    App->>App: Update UI
    App-->>User: Show Updated State
```

## 7. Dynamic Configurations

### 7.1 Feed Configuration
```json
{
  "feed_config": {
    "pagination": {
      "itemsPerPage": "number",
      "loadMoreThreshold": "number"
    },
    "contentTypes": {
      "enabled": ["string"],
      "order": ["string"]
    },
    "interactions": {
      "enabled": ["string"],
      "limits": {
        "likes": "number",
        "comments": "number"
      }
    }
  }
}
```

### 7.2 Feed Item Configuration
```json
{
  "feed_item_config": {
    "content": {
      "maxLength": "number",
      "allowedMedia": ["string"],
      "previewLength": "number"
    },
    "questions": {
      "maxOptions": "number",
      "required": "boolean",
      "validation": "object"
    },
    "plugins": {
      "enabled": ["string"],
      "config": "object"
    }
  }
}
```

## 8. Error Handling

### 8.1 Feed Error States
```dart
enum FeedError {
  loadFailed,
  networkError,
  invalidData,
  permissionDenied,
  rateLimited
}
```

### 8.2 Feed Item Error States
```dart
enum FeedItemError {
  loadFailed,
  interactionFailed,
  validationFailed,
  mediaError,
  pluginError
}
```

This architecture provides a robust and flexible system for managing and displaying feed content with various types of items and interactions. The modular design allows for easy extension and maintenance, while the state management ensures consistent behavior across the application.
